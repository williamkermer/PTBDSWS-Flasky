{% extends "base.html" %}
{% import "bootstrap/wtf.html" as wtf %}

{% block title %}Flasky{% endblock %}

{% block page_content %}
<div class="page-header">
    <h1>Olá, {% if name %}{{ name }}{% else %}Stranger{% endif %}!</h1>
    {% if not known %}
    <p>Prazer em conhecê-lo!</p>
    {% else %}
    <p>Feliz em vê-lo novamente!</p>
    {% endif %}
</div>
{{ wtf.quick_form(form) }}

<h2>Relação de usuários cadastrados</h2>
<h4>Quantidade: {{ user_count }}</h4>
{% if users %}
    <table class="table">
        <thead>
            <tr>
                <th>Nome do usuário</th>
                <th>Função</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <td>{{ user.username }}</td>
                <td>
                    {% if user.role %}
                        {{ user.role.name }}
                    {% else %}
                        <span class="text-muted">Sem função</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <p>Nenhum usuário cadastrado ainda.</p>
{% endif %}

<h2>Relação de funções cadastradas</h2>
<h4>Quantidade: {{ role_count }}</h4>
{% if roles %}
    <table class="table">
        <thead>
            <tr>
                <th style="width: 20%;">Funções</th>
                <th>Usuários</th>
            </tr>
        </thead>
        <tbody>
            {% for role in roles %}
            <tr>
                <td><strong>{{ role.name }}</strong></td>
                <td>
                    {% for user in role.users.order_by('id') %}
                        {{ loop.index }}. {{ user.username }}<br>
                    {% else %}
                        <span class="text-muted">Nenhum usuário nesta função.</span>
                    {% endfor %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% endif %}
{% endblock %}
